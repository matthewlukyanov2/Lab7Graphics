<!DOCTYPE html>
<html>
 <head>

    <!-- Include D3.js via CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Include jQuery via CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

 <title>D3.js Demo</title>
 <meta charset="UTF-8">
 <!-- CSS Section -->
 <style type="text/css">
    body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        h1 {
            text-align: center;
            color: #4CAF50;
            margin-top: 50px;
        }

 </style>
 </head>
 <body>
    <h1>Matthew</h1>
    <!-- JavaScript Section -->
 <script type="text/javascript">
      // Function to plot the CO2 data
      function plotCO2Data(data) {

       // Print out the first few values from the data to verify
      console.log("Plotting the CO2 Data:", data);

        // Setup SVG size and margins
        const svgWidth = 800, svgHeight = 400;
        const margin = { top: 20, right: 30, bottom: 50, left: 50 };
        const width = svgWidth - margin.left - margin.right;
        const height = svgHeight - margin.top - margin.bottom;

        // Create an SVG element and append it to the body
        const svg = d3.select("body")
            .append("svg")
            .attr("width", svgWidth)
            .attr("height", svgHeight)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Check the structure of data to ensure it's an array of objects
            console.log("Data Structure after processing:", data);

            // Create x and y scales
        const x = d3.scaleLinear()
            .domain([d3.min(data, d => d.year), d3.max(data, d => d.year)])  // Years
            .range([0, width]);

        const y = d3.scaleLinear()
            .domain([d3.min(data, d => d.co2), d3.max(data, d => d.co2)])  // CO2 levels 
            .range([height, 0]);

            const yTemp = d3.scaleLinear()
            .domain([d3.min(data, d => d.temperature), d3.max(data, d => d.temperature)])  // Temperature anomaly
            .range([height, 0]);

        const yMethane = d3.scaleLinear()
            .domain([d3.min(data, d => d.methane), d3.max(data, d => d.methane)])  // Methane levels
            .range([height, 0]);

        // Create axis, 10 ticks for x and 6 for y 
        const xAxis = d3.axisBottom(x).ticks(10); 
        const yAxis = d3.axisLeft(y).ticks(6);  

        // The line generator
        const line = d3.line()
            .x(d => x(d.year))  
            .y(d => y(d.co2));  

            // Append x and y axis to the SVG
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);  // Add x-axis at the bottom

        svg.append("g")
            .call(yAxis);  // Add y-axis on the left

        // Append the line to the SVG and bind the data
        svg.append("path")
            .data([data])  
            .attr("fill", "none")  
            .attr("stroke", "red")  
            .attr("stroke-width", 2)  
            .attr("d", line);  

        // Add labels for the axis
        // x-axis label
        svg.append("text")  
            .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.top + 30) + ")")
            .style("text-anchor", "middle")
            .style("font-size", "14px")
            .text("Years Ago");

        // y-axis label
        svg.append("text")  
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left + 20)
            .attr("x", 0 - (height / 2))
            .style("text-anchor", "middle")
            .style("font-size", "14px")
            .text("CO2 (ppm)");

         // Chart title
        svg.append("text")  
            .attr("x", width / 2)
            .attr("y", -10)
            .style("text-anchor", "middle")
            .style("font-size", "16px")
            .style("font-weight", "bold")
            .text("CO2 Levels Over Time");
      }

    // Fetch JSON data dynamically
    fetch('https://tinyurl.com/k4chnujx')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json(); // Parse JSON data
            })
            .then(data => {
                console.log("JSON Data Successfully Fetched:");
                console.log(data); // Log the data to the console
                plotCO2Data(data); // Call the function to plot the data after it's fetched
            })
            .catch(error => {
                console.error("Failed to fetch JSON:", error);
            });
 </script>
 </body>
</html>
